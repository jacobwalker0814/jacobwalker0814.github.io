{"result": [{"date": "2013-01-06", "body": "<p>Looking through the <a href=\"https://github.com/PHPOffice/PHPExcel\">PHPExcel</a> library\nrecently I saw how Mark Baker overrides the magic <code>__clone</code> method with\ncomments about ensuring that cloning will perform a deep copy instead of a\nshallow one. This is a topic with which I had not had much experience so I did\nsome research and experimenting to learn what happens when you use <code>clone</code> and\nthe difference between a shallow copy and a deep copy.</p>\n<p>First I examined how you might copy variables in general. Let's start with the\nbasics.</p>\n<pre><code class=\"php\">// Example 1\n$foo = 1;\n$bar = $foo; // Copy by value\n++$bar;\nprint $bar; // Outputs 2\nprint $foo; // Outputs 1\n</code></pre>\n\n<p><code>$bar</code> is a copy of <code>$foo</code>. Incrementing <code>$bar</code> has no effect on <code>$foo</code>. If we\nwanted different behavior we would need to copy by reference with the use of an\nampersand.</p>\n<pre><code class=\"php\">// Example 2\n$foo = 1;\n$bar =&amp; $foo; // Copy by reference\n++$bar;\nprint $bar; // Outputs 2\nprint $foo; // Outputs 2\n</code></pre>\n\n<p>Now when we increment <code>$bar</code> we are also incrementing <code>$foo</code>. Well, not really.\n<code>$foo</code>, the variable, is a handle or reference to where the data is stored in\nmemory. In the first example we copy by value which (more or less) makes a new\nentry in memory and <code>$bar</code> is a handle to that new location. In the second\nexample <code>$bar</code> simply copies the handle. There is only one entry in memory and\nboth <code>$foo</code> and <code>$bar</code> point to the same location. What we are actually doing\nwhen we increment <code>$bar</code> is incrementing the data referenced by <code>$bar</code>. <code>$foo</code>\nreferences the same data.</p>\n<p>Next I looked at how to copy objects. I started with this simple class Project.</p>\n<pre><code class=\"php\">&lt;?php\n\nclass Project {\n    protected $description;\n\n    public function setDescription($description) {\n        $this-&gt;description = $description;\n\n        return $this;\n    }\n\n    public function getDescription() {\n        return $this-&gt;description;\n    }\n}\n</code></pre>\n\n<p>I repeated the same copy assignment from Example 1.</p>\n<pre><code class=\"php\">$project_one = new Project();\n$project_one-&gt;setDescription(&quot;This is my first test project&quot;);\n$project_two = $project_one; // Copying by value?\n</code></pre>\n\n<p>In the previous examples we would have two completely distinct variables that\nreference two different addresses in memory. So to see if this holds true we\ncan make a change in <code>$project_two</code> and see the impact.</p>\n<pre><code class=\"php\">$project_two-&gt;setDescription(&quot;A new description for my copied project&quot;);\nprint $project_one-&gt;getDescription();\n</code></pre>\n\n<p>Based on Example 1 we might expect that this would print the original\ndescription we set in <code>$project_one</code>. In fact, it will actually print the new\ndescription. It appears that the objects are copied by reference. One of the\nthings you will often hear is that in PHP 5 objects are copied by reference by\ndefault. Some research shows that isn't quite true either. Consider this\nexplanation from\n<a href=\"http://php.net/manual/en/language.oop5.references.php\">PHP.net</a></p>\n<blockquote>\n<p>A PHP reference is an alias, which allows two different variables to write to\nthe same value. As of PHP 5, an object variable doesn't contain the object\nitself as value anymore. It only contains an object identifier which allows\nobject accessors to find the actual object. When an object is sent by\nargument, returned or assigned to another variable, the different variables\nare not aliases: they hold a copy of the identifier, which points to the same\nobject.</p>\n</blockquote>\n<p>This means copying an object by value will copy the identifier... by value.\nThis behaves very similarly to copying by reference because the copied\nidentifier points to the same object but is not exactly the same. For a more\ndetailed explanation of the difference you can visit the source link.</p>\n<p>So what if you don't want this behavior? Here enters the <code>clone</code> keyword.</p>\n<pre><code class=\"php\">$project_one = new Project();\n$project_one-&gt;setDescription(&quot;This is my first test project&quot;);\n$project_two = clone $project_one; // Cloning to get a new object\n</code></pre>\n\n<p>Now $project_two is a clone of <code>$project_one</code> and is its own honest object.\nWhen we repeat the test with the descriptions we will see that monkeying around\nwith <code>$project_two</code>'s description has no effect on <code>$project_one</code>.</p>\n<p>What happens if the property of a Project is another object? To test this I\ncreated a new class Person and modified Project to hold a Person</p>\n<pre><code class=\"php\">&lt;?php\n\nclass Person {\n    protected $name;\n\n    public function setName($name) {\n        $this-&gt;name = $name;\n\n        return $this;\n    }\n\n    public function getName() {\n        return $this-&gt;name;\n    }\n}\n</code></pre>\n\n<pre><code class=\"php\">&lt;?php\n\nclass Project {\n    protected $leadDeveloper;\n\n    public function setLeadDeveloper(Person $developer) {\n        $this-&gt;leadDeveloper = $developer;\n\n        return $this;\n    }\n\n    public function getLeadDeveloper() {\n        return $this-&gt;leadDeveloper;\n    }\n}\n</code></pre>\n\n<p>I then made a Project and set its Lead Developer.</p>\n<pre><code class=\"php\">$jacob = new Person();\n$jacob-&gt;setName(&quot;Jacob&quot;);\n\n$project_one = new Project();\n$project_one-&gt;setLeadDeveloper($jacob);\n$project_two = clone $project_one;\n\n$matthew = new Person();\n$matthew-&gt;setName(&quot;Matthew&quot;);\n$project_two-&gt;setLeadDeveloper($matthew);\n\nprint $project_one-&gt;getLeadDeveloper()-&gt;getName(); // Outputs &quot;Jacob&quot;\n</code></pre>\n\n<p>As <code>$project_two</code> is a clone, setting a new value for\n<code>$project_two-&gt;leadDeveloper</code> did not change <code>$project_one</code>. Great, right?\nLet's look at this from a different angle.</p>\n<pre><code class=\"php\">$jacob = new Person();\n$jacob-&gt;setName(&quot;Jacob&quot;);\n\n$project_one = new Project();\n$project_one-&gt;setLeadDeveloper($jacob);\n$project_two = clone $project_one;\n\n$project_two-&gt;getLeadDeveloper()-&gt;setName(&quot;Matthew&quot;);\n\nprint $project_one-&gt;getLeadDeveloper()-&gt;getName(); // Outputs &quot;Matthew&quot;\n</code></pre>\n\n<p>The plot thickens. Here we can see that <code>$project_one-&gt;leadDeveloper</code> and\n<code>$project_two-&gt;leadDeveloper</code> both point to the same object. $project_one\nand $project_two are both unique objects but they do not have unique values for\nproperties that are references or object identifiers. This is what is meant by\na shallow copy. If we wanted the two projects to be completely separate we\nwould need to change the default behavior of clone to perform a deep copy\ninstead of a shallow copy. To do this I define the magic <code>__clone</code> method.</p>\n<pre><code class=\"php\">class Project {\n    // Snip properties, getters, and setters\n\n    public function __clone() {\n        $this-&gt;leadDeveloper = clone $this-&gt;leadDeveloper;\n    }\n}\n</code></pre>\n\n<p>After PHP clones an object it will attempt to call the <code>__clone</code> method on\n<strong>the new cloned object</strong>. Now when we perform the previous test we can see\nthat <code>$project_one-&gt;leadDeveloper</code> and <code>$project_two-&gt;leadDeveloper</code>\npoint to two completely different objects. This is a deep copy.</p>\n<p>Note that a common technique for ensuring a deep copy is to serialize then\nimmediately unserialize each of a class's object properties. Take for example\nthis code from PHPExcel</p>\n<pre><code class=\"php\">public function __clone() {\n    foreach($this as $key =&gt; $val) {\n        if (is_object($val) || (is_array($val))) {\n            $this-&gt;{$key} = unserialize(serialize($val));\n        }\n    }\n}\n</code></pre>\n\n<p>This method forces PHP to split apart any object properties from their\nreferences and return new instances.</p>\n<p>Additional information and examples about cloning can be found on\n<a href=\"http://php.net/manual/en/language.oop5.cloning.php\">php.net</a></p>", "_id": "php-clone-and-shallow-vs-deep-copying", "title": "PHP Clone and Shallow vs Deep Copying"}, {"date": "2013-02-02", "body": "<p>Steve Francia (commonly referred to as <a href=\"http://spf13.com\">spf13</a> works at\n<a href=\"http://www.10gen.com/\">10gen</a> on the popular NoSQL database\n<a href=\"http://en.wikipedia.org/wiki/Mongodb\">MongoDB</a>. That's impressive, but more\nimportantly to me he maintains spf13-vim which is appropriately self titled\n\"The Ultimate Vim Distribution.\"</p>\n<p>sfp13-vim is a collection of plugins and configurations to boost your\n<a href=\"http://www.vim.org\">Vim</a> experience. It is designed to work across different\noperating systems with minimal external dependencies. Installing it is trivial\nfor those running Linux or Macs and worth the effort if you're using Windows.\nInstalling the distribution is what helped me make the leap from \"modern\" IDEs\nto working solely in Vim.</p>\n<p>spf13 has done you a favor by reviewing different plugins and combining them\ntogether into this distribution. I have further tweaked the distribution to\nsuit my own preferences and workflow. spf13 made the configuration convenient\nto edit by writing your own .vimrc.local and .vimrc.bundles.local files. Use\nthe former for defining macros, functions, and keybindings and use the latter\nto enable/disable plugins or groups of plugins.</p>\n<p>If you would like to use my fork, and I so hope that you do, just visit\n<a href=\"https://github.com/jacobwalker0814/spf13-vim\">jacobwalker0814/spf13-vim</a> on\ngithub and follow the installation instructions. I will be adding additional\nresources and updating the documentation soon so stay tuned.</p>\n<h2>Update</h2>\n<p>Since this post was originally written I have stopped maintaining my spf13\nfork. spf13-vim is still a great distribution that I follow closely and I would\nrecommend it to anyone who wants to get a full featured vim configuration setup\nwithout doing all of the leg work. My own vim configuration is part of <a href=\"https://github.com/jacobwalker0814/mydotfiles\">My\nDotfiles Repo</a>.</p>", "_id": "spf13-vim", "title": "spf13-vim: The Ultimate Vim Distribution"}, {"date": "2013-06-27", "body": "<p>InnoDB is a great storage engine for MySQL offering, among other things,\ntransaction support. One of its drawbacks is the difficulty that you can face\nwhen corruption inevitably hits.</p>\n<p>At work we have dealt with corrupt InnoDB tables often enough to make the\nprocedure fairly routine. Last week I was faced with a situation that had me\npulling my hair out; in fact we almost threw in the towel.</p>\n<p>In this particular instance I was connecting to the database with the standard\ncommand line client <code>mysql</code>. Every time I ran any query (against the corrupt\ntable or not) I was slapped in the face with the annoying \"MySQL Server Has\nGone Away\" message. Even queries like <code>SHOW PROCESSLIST;</code> would trigger the\nproblem.</p>\n<p>Right before we gave up I had an idea. When you start the client it gives you\nthe following message:</p>\n<pre><code>Reading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n</code></pre>\n<p>What this means is that the client looks up meta information about the tables\nand columns in your selected database so that when you hit <kbd>TAB</kbd> it\nwill auto fill the table names like you would get on the command line. The list\nof tables and columns is rebuilt any time you change databases or issue the\n<code>REHASH;</code> command.</p>\n<p>On a hunch I tried starting the client with the <span class=\"code\">-A</span>\nflag to prevent this table scanning. I don't know the technical reason within\nMySQL's binaries but with this option enabled my problem went away. I can only\nassume that when the client scans the tables (including the corrupt table)\nsomething goes horribly wrong.</p>\n<p>So just file that away in your DBA utility belt :)</p>", "_id": "a-note-on-recovering-from-innodb-corruption", "title": "A Note on Recovering from InnoDB Corruption"}, {"date": "2013-03-29", "body": "<p>I recently joined a a great group of local developers called UpFront Wichita\n(edit: now called <a href=\"http://meetup.com/devict\">devICT</a>. The organizers were so\ngracious as to let me present last night on one of my favorite topics: Regular\nExpressions.</p>\n<p>We recorded the presentation using Google Hangouts on Air. The video is\navailable on <a href=\"http://youtu.be/4nyHF8dnIk\" title=\"Regular Expressions 101 on\nYouTube\">YouTube</a>. The slides, source code, and text files used for examples are\navailable on <a href=\"https://github.com/upfrontwichita/Regex101\" title=\"Regular\nExpressions 101 on GitHub\">GitHub</a>.</p>\n<p>The video was our first attempt at recording one of these presentations. At our\nnext meetup we will do things a little differently to produce a better video\nand to provide better support for remote participants that want to participate\nin the hangout.</p>\n<p>The presentation covers the most commonly used features of regex and some of\nthe nicer advanced features like backreferences and assertions. Most of the\nresearch for the presentation comes from\n<a href=\"http://www.regular-expressions.info/\">regular-expressions.info</a>. Interested\nreaders should check out that site's references on some of the crazier things\nyou can do.</p>", "_id": "regular-expressions-101", "title": "Regular Expressions 101"}]}